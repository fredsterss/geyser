// Generated by CoffeeScript 1.3.3
(function() {

  this.Geyser = (function() {

    function Geyser() {}

    Geyser.prototype.firebaseRef = 'https://geyser.firebaseio.com';

    Geyser.prototype.savePage = function() {
      var _this = this;
      this.getFile();
      return chrome.tabs.getSelected(null, function(tab) {
        return chrome.pageCapture.saveAsMHTML({
          tabId: tab.id
        }, function(mhtml) {
          return _this.reader.readAsDataURL(mhtml);
        });
      });
    };

    Geyser.prototype.getFile = function() {
      var _this = this;
      this.reader = new FileReader();
      return this.reader.onload = function(file) {
        var dt, f;
        dt = new Date().getTime();
        f = new Firebase("" + _this.firebaseRef + "/users/fred/captures/" + dt);
        _this.setIconState('pending');
        return f.set(file.target.result, function() {
          _this.setIconState('success');
          return setTimeout(function() {
            return _this.setIconState('normal');
          }, 10000);
        });
      };
    };

    Geyser.prototype.setIconState = function(state) {
      return chrome.browserAction.setIcon({
        path: "assets/sandwich-128-" + state + ".png"
      });
    };

    return Geyser;

  })();

}).call(this);
